<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Pencil configurations · PencilArrays.jl</title><meta name="title" content="Pencil configurations · PencilArrays.jl"/><meta property="og:title" content="Pencil configurations · PencilArrays.jl"/><meta property="twitter:title" content="Pencil configurations · PencilArrays.jl"/><meta name="description" content="Documentation for PencilArrays.jl."/><meta property="og:description" content="Documentation for PencilArrays.jl."/><meta property="twitter:description" content="Documentation for PencilArrays.jl."/><meta property="og:url" content="https://jipolanco.github.io/PencilArrays.jl/Pencils/"/><meta property="twitter:url" content="https://jipolanco.github.io/PencilArrays.jl/Pencils/"/><link rel="canonical" href="https://jipolanco.github.io/PencilArrays.jl/Pencils/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/custom.css" rel="stylesheet" type="text/css"/><script src="../assets/tomate.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="PencilArrays.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">PencilArrays.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Library</span><ul><li class="is-active"><a class="tocitem" href>Pencil configurations</a><ul class="internal"><li><a class="tocitem" href="#Construction"><span>Construction</span></a></li><li><a class="tocitem" href="#Dimension-permutations"><span>Dimension permutations</span></a></li><li><a class="tocitem" href="#Types"><span>Types</span></a></li><li><a class="tocitem" href="#Methods"><span>Methods</span></a></li><li><a class="tocitem" href="#Index"><span>Index</span></a></li></ul></li><li><a class="tocitem" href="../PencilArrays/">Array wrappers</a></li><li><a class="tocitem" href="../LocalGrids/">Working with grids</a></li><li><a class="tocitem" href="../Transpositions/">Global MPI operations</a></li><li><a class="tocitem" href="../PencilIO/">Parallel I/O</a></li><li><a class="tocitem" href="../MPITopology/">MPI topology</a></li><li><a class="tocitem" href="../PencilArrays_timers/">Measuring performance</a></li></ul></li><li><span class="tocitem">Additional notes</span><ul><li><a class="tocitem" href="../notes/reductions/">Reductions</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Library</a></li><li class="is-active"><a href>Pencil configurations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Pencil configurations</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/jipolanco/PencilArrays.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/jipolanco/PencilArrays.jl/blob/master/docs/src/Pencils.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="sec:pencil_configs"><a class="docs-heading-anchor" href="#sec:pencil_configs">Pencil configurations</a><a id="sec:pencil_configs-1"></a><a class="docs-heading-anchor-permalink" href="#sec:pencil_configs" title="Permalink"></a></h1><p>A <em>pencil</em> configuration refers to a given distribution of multidimensional data among MPI processes. This information is encoded in the <a href="#PencilArrays.Pencils.Pencil"><code>Pencil</code></a> type.</p><p>A pencil configuration includes:</p><ul><li><a href="../MPITopology/#sec:mpi_topology">MPI topology</a> information,</li><li>global and local dimensions of the numerical grid,</li><li>subset of decomposed dimensions,</li><li>definition of optional permutation of dimensions.</li></ul><h2 id="Construction"><a class="docs-heading-anchor" href="#Construction">Construction</a><a id="Construction-1"></a><a class="docs-heading-anchor-permalink" href="#Construction" title="Permalink"></a></h2><h3 id="pencil-high-level"><a class="docs-heading-anchor" href="#pencil-high-level">High-level interface</a><a id="pencil-high-level-1"></a><a class="docs-heading-anchor-permalink" href="#pencil-high-level" title="Permalink"></a></h3><p>The simplest way of constructing a new <a href="#PencilArrays.Pencils.Pencil"><code>Pencil</code></a> is by passing the global dataset dimensions and an MPI communicator to the <code>Pencil</code> constructor:</p><pre><code class="language-julia-repl hljs">julia&gt; dims_global = (16, 32, 64);

julia&gt; comm = MPI.COMM_WORLD;

julia&gt; pen = Pencil(dims_global, comm)
Decomposition of 3D data
    Data dimensions: (16, 32, 64)
    Decomposed dimensions: (2, 3)
    Data permutation: NoPermutation()</code></pre><p>This will decompose the data along the two last dimensions of the dataset:<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup></p><pre><code class="language-julia-repl hljs">julia&gt; decomposition(pen)
(2, 3)</code></pre><p>For instance, if the communicator <code>comm</code> has 4 MPI processes, then each process will hold a subset of data of size <code>(16, 16, 32)</code>:</p><pre><code class="language-julia-repl hljs">julia&gt; topology(pen)
MPI topology: 2D decomposition (2×2 processes)  # assuming MPI.Comm_size(comm) == 4

julia&gt; size_local(pen)
(16, 16, 32)</code></pre><p>Instead of the default, one may want to choose the subset of dimensions that should be decomposed. For instance, to decompose along the first dimension only:</p><pre><code class="language-julia-repl hljs">julia&gt; decomp_dims = (1,);

julia&gt; pen = Pencil(dims_global, decomp_dims, comm)
Decomposition of 3D data
    Data dimensions: (16, 32, 64)
    Decomposed dimensions: (1,)
    Data permutation: NoPermutation()

julia&gt; decomposition(pen)
(1,)

julia&gt; topology(pen)
MPI topology: 1D decomposition (4 processes)  # again, assuming 4 MPI processes</code></pre><h3 id="Low-level-interface"><a class="docs-heading-anchor" href="#Low-level-interface">Low-level interface</a><a id="Low-level-interface-1"></a><a class="docs-heading-anchor-permalink" href="#Low-level-interface" title="Permalink"></a></h3><p>Note that the above high-level constructors don&#39;t require the definition of a <a href="../MPITopology/#PencilArrays.Pencils.MPITopologies.MPITopology"><code>MPITopology</code></a>, which is constructed implicitly. For more control, one may want to manually construct a <code>MPITopology</code>, and then construct a <code>Pencil</code> from that. As above, one may also specify the list of decomposed dimensions.</p><p>For instance, we may want to decompose 32 MPI processes into a 8×4 Cartesian topology. This is done as follows:</p><pre><code class="language-julia-repl hljs">julia&gt; topo = MPITopology(comm, (8, 4))  # NOTE: fails if MPI.Comm_size(comm) ≠ 32
MPI topology: 2D decomposition (8×4 processes)

julia&gt; dims_global = (16, 32, 64);

julia&gt; pen = Pencil(topo, dims_global)
Decomposition of 3D data
    Data dimensions: (16, 32, 64)
    Decomposed dimensions: (2, 3)
    Data permutation: NoPermutation()</code></pre><p>As before, the decomposed dimensions are the rightmost ones by default (in this case, dimensions <code>2</code> and <code>3</code>). A different set of dimensions may be selected via an optional positional argument. For instance, to decompose along dimensions <code>1</code> and <code>3</code> instead:</p><pre><code class="language-julia-repl hljs">julia&gt; decomp_dims = (1, 3);

julia&gt; pen = Pencil(topo, dims_global, decomp_dims)
Decomposition of 3D data
    Data dimensions: (16, 32, 64)
    Decomposed dimensions: (1, 3)
    Data permutation: NoPermutation()</code></pre><h3 id="Defining-multiple-pencils"><a class="docs-heading-anchor" href="#Defining-multiple-pencils">Defining multiple pencils</a><a id="Defining-multiple-pencils-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-multiple-pencils" title="Permalink"></a></h3><p>One may also want to work with multiple pencil configurations that differ, for instance, on the selection of decomposed dimensions. For this case, a constructor is available that takes an already existing <code>Pencil</code> instance. Calling this constructor should be preferred when possible since it allows sharing memory buffers (used for instance for <a href="../Transpositions/#Global-MPI-operations">global transpositions</a>) and thus reducing memory usage. The following creates a <code>Pencil</code> equivalent to the one above, but with different decomposed dimensions:</p><pre><code class="language-julia-repl hljs">julia&gt; pen_y = Pencil(pen; decomp_dims = (1, 3))
Decomposition of 3D data
    Data dimensions: (16, 32, 64)
    Decomposed dimensions: (1, 3)
    Data permutation: NoPermutation()</code></pre><p>See the <a href="#PencilArrays.Pencils.Pencil"><code>Pencil</code></a> documentation for more details.</p><h2 id="Dimension-permutations"><a class="docs-heading-anchor" href="#Dimension-permutations">Dimension permutations</a><a id="Dimension-permutations-1"></a><a class="docs-heading-anchor-permalink" href="#Dimension-permutations" title="Permalink"></a></h2><p>A <code>Pencil</code> may optionally be given information on dimension permutations. In this case, the layout of the data arrays in memory is different from the logical order of dimensions. For performance reasons, permutations are compile-time objects defined in the <a href="https://github.com/jipolanco/StaticPermutations.jl">StaticPermutations</a> package.</p><p>To make permutations clearer, consider the example above where the global data dimensions are <span>$N_x × N_y × N_z = 16 × 32 × 64$</span>. In this case, the logical order is <span>$(x, y, z)$</span>. Now let&#39;s say that we want the memory order of the data to be <span>$(y, z, x)$</span>,<sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup> which corresponds to the permutation <code>(2, 3, 1)</code>.</p><p>Permutations are passed to the <code>Pencil</code> constructor via the <code>permute</code> keyword argument. Dimension permutations should be specified using a <a href="https://jipolanco.github.io/StaticPermutations.jl/stable/#StaticPermutations.Permutation"><code>Permutation</code></a> object. For instance,</p><pre><code class="language-julia-repl hljs">julia&gt; perm = Permutation(2, 3, 1);

julia&gt; pen = Pencil(dims_global, comm; permute = perm)
Decomposition of 3D data
    Data dimensions: (16, 32, 64)
    Decomposed dimensions: (2, 3)
    Data permutation: Permutation(2, 3, 1)</code></pre><p>One can also pass a <a href="https://jipolanco.github.io/StaticPermutations.jl/stable/#StaticPermutations.NoPermutation"><code>NoPermutation</code></a> to disable permutations (this is the default).</p><h2 id="Types"><a class="docs-heading-anchor" href="#Types">Types</a><a id="Types-1"></a><a class="docs-heading-anchor-permalink" href="#Types" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PencilArrays.Pencils.Pencil" href="#PencilArrays.Pencils.Pencil"><code>PencilArrays.Pencils.Pencil</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Pencil{N,M}</code></pre><p>Describes the decomposition of an <code>N</code>-dimensional array among MPI processes along <code>M</code> directions (with <code>M &lt; N</code>).</p><hr/><pre><code class="nohighlight hljs">Pencil(
    [A = Array],
    topology::MPITopology{M}, size_global::Dims{N},
    decomp_dims::Dims{M} = default_decomposition(N, Val(M));
    permute::AbstractPermutation = NoPermutation(),
    timer = TimerOutput(),
)</code></pre><p>Define the decomposition of an <code>N</code>-dimensional geometry along <code>M</code> dimensions.</p><p>The dimensions of the geometry are given by <code>size_global = (N1, N2, ...)</code>. The <code>Pencil</code> describes the decomposition of an array of dimensions <code>size_global</code> across a group of MPI processes.</p><p>Data is distributed over the given <code>M</code>-dimensional MPI topology (with <code>M ≤ N</code>).</p><p>The decomposed dimensions may optionally be provided via the <code>decomp_dims</code> argument. By default, the <code>M</code> rightmost dimensions are decomposed. For instance, for a 2D decomposition of 5D data (<code>M = 2</code> and <code>N = 5</code>), the dimensions <code>(4, 5)</code> are decomposed by default.</p><p>It is also possible to distribute over all dimensions (<code>M = N</code>). Note that, in this specific case, <a href="../Transpositions/#Global-MPI-operations">transpositions</a> are currently not possible.</p><p>The optional argument <code>A</code> allows to work with arrays other than the base <code>Array</code> type. In particular, this should be useful for working with GPU array types such as <code>CuArray</code>.</p><p>The optional <code>permute</code> parameter may be used to indicate a permutation of the data indices from <strong>logical order</strong> (the order in which the arrays are accessed in code) to <strong>memory order</strong> (the actual order of indices in memory). Permutations must be specified using the exported <code>Permutation</code> type, as in <code>permute = Permutation(3, 1, 2)</code>.</p><p>It is also possible to pass a <code>TimerOutput</code> to the constructor. See <a href="../PencilArrays_timers/#PencilArrays.measuring_performance">Measuring performance</a> for details.</p><p><strong>Examples</strong></p><p>Decompose a 3D geometry of global dimensions <span>$N_x × N_y × N_z = 4×8×12$</span> along the second (<span>$y$</span>) and third (<span>$z$</span>) dimensions:</p><pre><code class="language-julia-repl hljs">julia&gt; topo = MPITopology(MPI.COMM_WORLD, Val(2));

julia&gt; Pencil(topo, (4, 8, 12), (2, 3))
Decomposition of 3D data
    Data dimensions: (4, 8, 12)
    Decomposed dimensions: (2, 3)
    Data permutation: NoPermutation()
    Array type: Array

julia&gt; Pencil(topo, (4, 8, 12), (2, 3); permute = Permutation(3, 2, 1))
Decomposition of 3D data
    Data dimensions: (4, 8, 12)
    Decomposed dimensions: (2, 3)
    Data permutation: Permutation(3, 2, 1)
    Array type: Array
</code></pre><p>In the second case, the actual data is stored in <code>(z, y, x)</code> order within each MPI process.</p><hr/><pre><code class="nohighlight hljs">Pencil([A = Array], size_global::Dims{N}, [decomp_dims = (2, …, N)], comm::MPI.Comm; kws...)</code></pre><p>Convenience constructor that implicitly creates a <a href="../MPITopology/#PencilArrays.Pencils.MPITopologies.MPITopology"><code>MPITopology</code></a>.</p><p>The number of decomposed dimensions specified by <code>decomp_dims</code> must be <code>M &lt; N</code>. If <code>decomp_dims</code> is not passed, dimensions <code>2:N</code> are decomposed.</p><p>Keyword arguments are passed to alternative constructor taking an <code>MPITopology</code>. That constructor should be used if more control is desired.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; Pencil((4, 8, 12), MPI.COMM_WORLD)
Decomposition of 3D data
    Data dimensions: (4, 8, 12)
    Decomposed dimensions: (2, 3)
    Data permutation: NoPermutation()
    Array type: Array

julia&gt; Pencil((4, 8, 12), (1, ), MPI.COMM_WORLD)
Decomposition of 3D data
    Data dimensions: (4, 8, 12)
    Decomposed dimensions: (1,)
    Data permutation: NoPermutation()
    Array type: Array</code></pre><hr/><pre><code class="nohighlight hljs">Pencil(
    [A = Array],
    p::Pencil{N,M};
    decomp_dims::Dims{M} = decomposition(p),
    size_global::Dims{N} = size_global(p),
    permute::P = permutation(p),
    timer::TimerOutput = timer(p),
)</code></pre><p>Create new pencil configuration from an existent one.</p><p>This constructor enables sharing temporary data buffers between the two pencil configurations, leading to reduced global memory usage.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/Pencils/Pencils.jl#L32-L150">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PencilArrays.Pencils.AbstractIndexOrder" href="#PencilArrays.Pencils.AbstractIndexOrder"><code>PencilArrays.Pencils.AbstractIndexOrder</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AbstractIndexOrder</code></pre><p>Abstract type determining the ordering of dimensions of an array with possibly permuted indices.</p><p>Subtypes are <a href="#PencilArrays.Pencils.MemoryOrder"><code>MemoryOrder</code></a> and <a href="#PencilArrays.Pencils.LogicalOrder"><code>LogicalOrder</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/Pencils/index_orders.jl#L1-L8">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PencilArrays.Pencils.MemoryOrder" href="#PencilArrays.Pencils.MemoryOrder"><code>PencilArrays.Pencils.MemoryOrder</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">MemoryOrder &lt;: AbstractIndexOrder</code></pre><p>Singleton type specifying that array dimensions should be given in memory (or <em>permuted</em>) order.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/Pencils/index_orders.jl#L11-L16">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PencilArrays.Pencils.LogicalOrder" href="#PencilArrays.Pencils.LogicalOrder"><code>PencilArrays.Pencils.LogicalOrder</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">LogicalOrder &lt;: AbstractIndexOrder</code></pre><p>Singleton type specifying that array dimensions should be given in logical (or <em>non-permuted</em>) order.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/Pencils/index_orders.jl#L19-L24">source</a></section></article><h2 id="Methods"><a class="docs-heading-anchor" href="#Methods">Methods</a><a id="Methods-1"></a><a class="docs-heading-anchor-permalink" href="#Methods" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PencilArrays.Pencils.topology-Tuple{Pencil}" href="#PencilArrays.Pencils.topology-Tuple{Pencil}"><code>PencilArrays.Pencils.topology</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">topology(p::Pencil)</code></pre><p>Get <a href="../MPITopology/#PencilArrays.Pencils.MPITopologies.MPITopology"><code>MPITopology</code></a> attached to <code>Pencil</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/Pencils/Pencils.jl#L474-L478">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PencilArrays.Pencils.MPITopologies.get_comm-Tuple{Pencil}" href="#PencilArrays.Pencils.MPITopologies.get_comm-Tuple{Pencil}"><code>PencilArrays.Pencils.MPITopologies.get_comm</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_comm(p::Pencil)</code></pre><p>Get MPI communicator associated to an MPI decomposition scheme.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/Pencils/Pencils.jl#L446-L450">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PencilArrays.Pencils.decomposition-Tuple{Pencil}" href="#PencilArrays.Pencils.decomposition-Tuple{Pencil}"><code>PencilArrays.Pencils.decomposition</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">decomposition(p::Pencil)</code></pre><p>Get tuple with decomposed dimensions of the given pencil configuration.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/Pencils/Pencils.jl#L467-L471">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PencilArrays.Permutations.permutation-Tuple{Pencil}" href="#PencilArrays.Permutations.permutation-Tuple{Pencil}"><code>PencilArrays.Permutations.permutation</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">permutation(::Type{&lt;:Pencil}) -&gt; AbstractPermutation
permutation(p::Pencil)        -&gt; AbstractPermutation</code></pre><p>Get index permutation associated to the given pencil configuration.</p><p>Returns <code>NoPermutation()</code> if there is no associated permutation.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/Pencils/Pencils.jl#L453-L460">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PencilArrays.Pencils.timer-Tuple{Pencil}" href="#PencilArrays.Pencils.timer-Tuple{Pencil}"><code>PencilArrays.Pencils.timer</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">timer(p::Pencil)</code></pre><p>Get <code>TimerOutput</code> attached to a <code>Pencil</code>.</p><p>See <a href="../PencilArrays_timers/#PencilArrays.measuring_performance">Measuring performance</a> for details.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/Pencils/Pencils.jl#L427-L433">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.length-Tuple{Pencil}" href="#Base.length-Tuple{Pencil}"><code>Base.length</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">length(p::Pencil)</code></pre><p>Get linear length of the <em>local</em> data associated to the decomposition.</p><p>Equivalent to <code>length_local(p)</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/Pencils/Pencils.jl#L481-L487">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.size-Tuple{Pencil}" href="#Base.size-Tuple{Pencil}"><code>Base.size</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">size(p::Pencil)</code></pre><p>Returns the <em>local</em> data dimensions associated to the decomposition, in <em>logical</em> order.</p><p>This is defined as <code>size_local(p, LogicalOrder())</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/Pencils/Pencils.jl#L561-L568">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.ndims-Tuple{Pencil}" href="#Base.ndims-Tuple{Pencil}"><code>Base.ndims</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ndims(t::MPITopology)</code></pre><p>Get dimensionality of Cartesian topology.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/Pencils/MPITopologies.jl#L168-L172">source</a></section><section><div><pre><code class="language-julia hljs">ndims(p::Pencil)</code></pre><p>Number of spatial dimensions associated to pencil data.</p><p>This corresponds to the total number of dimensions of the space, which includes the decomposed and non-decomposed dimensions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/Pencils/Pencils.jl#L436-L443">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PencilArrays.Pencils.range_remote-Tuple{Pencil, Integer, LogicalOrder}" href="#PencilArrays.Pencils.range_remote-Tuple{Pencil, Integer, LogicalOrder}"><code>PencilArrays.Pencils.range_remote</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">range_remote(p::Pencil, coords, [order = LogicalOrder()])
range_remote(p::Pencil, n::Integer, [order = LogicalOrder()])</code></pre><p>Get data range held by a given MPI process.</p><p>In the first variant, <code>coords</code> are the coordinates of the MPI process in the Cartesian topology. They can be specified as a tuple <code>(i, j, ...)</code> or as a <code>CartesianIndex</code>.</p><p>In the second variant, <code>n</code> is the linear index of a given process in the topology.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/Pencils/Pencils.jl#L516-L528">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PencilArrays.Pencils.range_local-Tuple{Pencil, LogicalOrder}" href="#PencilArrays.Pencils.range_local-Tuple{Pencil, LogicalOrder}"><code>PencilArrays.Pencils.range_local</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">range_local(p::Pencil, [order = LogicalOrder()])</code></pre><p>Local data range held by the pencil.</p><p>By default the dimensions are not permuted, i.e. they follow the logical order of dimensions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/Pencils/Pencils.jl#L504-L511">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PencilArrays.Pencils.size_global-Tuple{Pencil, LogicalOrder}" href="#PencilArrays.Pencils.size_global-Tuple{Pencil, LogicalOrder}"><code>PencilArrays.Pencils.size_global</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">size_global(p::Pencil, [order = LogicalOrder()])</code></pre><p>Global dimensions of the Cartesian grid associated to the given domain decomposition.</p><p>Like <a href="../PencilArrays/#PencilArrays.Pencils.size_local-Tuple{Union{AbstractArray{A} where A&lt;:PencilArray, Tuple{Vararg{A}} where A&lt;:PencilArray, PencilArray}}"><code>size_local</code></a>, by default the returned dimensions are in logical order.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/Pencils/Pencils.jl#L548-L556">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PencilArrays.Pencils.size_local-Tuple{Pencil, Vararg{Any}}" href="#PencilArrays.Pencils.size_local-Tuple{Pencil, Vararg{Any}}"><code>PencilArrays.Pencils.size_local</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">size_local(p::Pencil, [order = LogicalOrder()])</code></pre><p>Local dimensions of the data held by the pencil.</p><p>By default the dimensions are not permuted, i.e. they follow the logical order of dimensions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/Pencils/Pencils.jl#L538-L545">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PencilArrays.Pencils.length_global-Tuple{Pencil}" href="#PencilArrays.Pencils.length_global-Tuple{Pencil}"><code>PencilArrays.Pencils.length_global</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">length_global(p::Pencil)</code></pre><p>Get linear length of the global data associated to the decomposition.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/Pencils/Pencils.jl#L497-L501">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PencilArrays.Pencils.length_local-Tuple{Pencil}" href="#PencilArrays.Pencils.length_local-Tuple{Pencil}"><code>PencilArrays.Pencils.length_local</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">length_local(p::Pencil)</code></pre><p>Get linear length of the local data associated to the decomposition.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/Pencils/Pencils.jl#L490-L494">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PencilArrays.Pencils.to_local-Tuple{Pencil}" href="#PencilArrays.Pencils.to_local-Tuple{Pencil}"><code>PencilArrays.Pencils.to_local</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">to_local(p::Pencil, global_inds, [order = LogicalOrder()])</code></pre><p>Convert non-permuted (logical) global indices to local indices.</p><p>If <code>order = MemoryOrder()</code>, returned indices will be permuted using the permutation associated to the pencil configuration <code>p</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/Pencils/Pencils.jl#L571-L578">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.similar-Tuple{Pencil}" href="#Base.similar-Tuple{Pencil}"><code>Base.similar</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">similar(x::PencilArray, [element_type=eltype(x)], [dims]) -&gt; PencilArray</code></pre><p>Returns a <code>PencilArray</code> similar to <code>x</code>.</p><p>In particular, the new array shares the same parallel decomposition (the same <code>Pencil</code>) than <code>x</code>. This means that the dimensions of the new array must be the same as those of <code>x</code>. Note that the optional <code>dims</code> argument is allowed for the sole reason of making things work nicely with other packages (such as StructArrays.jl), but things will fail if <code>dims ≠ size(x)</code>.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; pen = Pencil((20, 10, 12), MPI.COMM_WORLD);

julia&gt; u = PencilArray{Float64}(undef, pen);

julia&gt; similar(u) |&gt; summary
&quot;20×10×12 PencilArray{Float64, 3}(::Pencil{3, 2, NoPermutation, Array})&quot;

julia&gt; similar(u, size(u)) |&gt; summary
&quot;20×10×12 PencilArray{Float64, 3}(::Pencil{3, 2, NoPermutation, Array})&quot;

julia&gt; similar(u, ComplexF32) |&gt; summary
&quot;20×10×12 PencilArray{ComplexF32, 3}(::Pencil{3, 2, NoPermutation, Array})&quot;

julia&gt; similar(u, (4, 3, 8))
ERROR: DimensionMismatch: cannot construct a similar PencilArray with different size

julia&gt; similar(u, (4, 3)) |&gt; summary
ERROR: DimensionMismatch: cannot construct a similar PencilArray with different size

julia&gt; similar(u, ComplexF32) |&gt; summary
&quot;20×10×12 PencilArray{ComplexF32, 3}(::Pencil{3, 2, NoPermutation, Array})&quot;

julia&gt; similar(u, ComplexF32, (4, 3))
ERROR: DimensionMismatch: cannot construct a similar PencilArray with different size</code></pre><hr/><pre><code class="nohighlight hljs">similar(x::PencilArray, [element_type = eltype(x)], p::Pencil)</code></pre><p>Create a <code>PencilArray</code> with the decomposition described by the given <code>Pencil</code>.</p><p>This variant may be used to create a <code>PencilArray</code> that has a different decomposition than the input <code>PencilArray</code>.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; pen_u = Pencil((20, 10, 12), (2, 3), MPI.COMM_WORLD);

julia&gt; u = PencilArray{Float64}(undef, pen_u);

julia&gt; pen_v = Pencil(pen_u; decomp_dims = (1, 3), permute = Permutation(2, 3, 1))
Decomposition of 3D data
    Data dimensions: (20, 10, 12)
    Decomposed dimensions: (1, 3)
    Data permutation: Permutation(2, 3, 1)
    Array type: Array

julia&gt; v = similar(u, pen_v);

julia&gt; summary(v)
&quot;20×10×12 PencilArray{Float64, 3}(::Pencil{3, 2, Permutation{(2, 3, 1), 3}, Array})&quot;

julia&gt; pencil(v) === pen_v
true

julia&gt; vint = similar(u, Int, pen_v);

julia&gt; summary(vint)
&quot;20×10×12 PencilArray{Int64, 3}(::Pencil{3, 2, Permutation{(2, 3, 1), 3}, Array})&quot;

julia&gt; pencil(vint) === pen_v
true
</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/arrays.jl#L207-L286">source</a></section><section><div><pre><code class="language-julia hljs">similar(p::Pencil, [A = typeof_array(p)], [dims = size_global(p)])</code></pre><p>Returns a <a href="#PencilArrays.Pencils.Pencil"><code>Pencil</code></a> decomposition with global dimensions <code>dims</code> and with underlying array type <code>A</code>.</p><p>Typically, <code>A</code> should be something like <code>Array</code> or <code>CuArray</code> (see <a href="#PencilArrays.Pencils.Pencil"><code>Pencil</code></a> for details).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jipolanco/PencilArrays.jl/blob/a5095462f49d096888c8e2ee6fe958d7dda6f538/src/Pencils/Pencils.jl#L306-L314">source</a></section></article><h2 id="Index"><a class="docs-heading-anchor" href="#Index">Index</a><a id="Index-1"></a><a class="docs-heading-anchor-permalink" href="#Index" title="Permalink"></a></h2><ul><li><a href="#PencilArrays.Pencils.AbstractIndexOrder"><code>PencilArrays.Pencils.AbstractIndexOrder</code></a></li><li><a href="#PencilArrays.Pencils.LogicalOrder"><code>PencilArrays.Pencils.LogicalOrder</code></a></li><li><a href="#PencilArrays.Pencils.MemoryOrder"><code>PencilArrays.Pencils.MemoryOrder</code></a></li><li><a href="#PencilArrays.Pencils.Pencil"><code>PencilArrays.Pencils.Pencil</code></a></li><li><a href="#Base.length-Tuple{Pencil}"><code>Base.length</code></a></li><li><a href="#Base.ndims-Tuple{Pencil}"><code>Base.ndims</code></a></li><li><a href="#Base.similar-Tuple{Pencil}"><code>Base.similar</code></a></li><li><a href="#Base.size-Tuple{Pencil}"><code>Base.size</code></a></li><li><a href="#PencilArrays.Pencils.MPITopologies.get_comm-Tuple{Pencil}"><code>PencilArrays.Pencils.MPITopologies.get_comm</code></a></li><li><a href="#PencilArrays.Pencils.decomposition-Tuple{Pencil}"><code>PencilArrays.Pencils.decomposition</code></a></li><li><a href="#PencilArrays.Pencils.length_global-Tuple{Pencil}"><code>PencilArrays.Pencils.length_global</code></a></li><li><a href="#PencilArrays.Pencils.length_local-Tuple{Pencil}"><code>PencilArrays.Pencils.length_local</code></a></li><li><a href="#PencilArrays.Pencils.range_local-Tuple{Pencil, LogicalOrder}"><code>PencilArrays.Pencils.range_local</code></a></li><li><a href="#PencilArrays.Pencils.range_remote-Tuple{Pencil, Integer, LogicalOrder}"><code>PencilArrays.Pencils.range_remote</code></a></li><li><a href="#PencilArrays.Pencils.size_global-Tuple{Pencil, LogicalOrder}"><code>PencilArrays.Pencils.size_global</code></a></li><li><a href="#PencilArrays.Pencils.size_local-Tuple{Pencil, Vararg{Any}}"><code>PencilArrays.Pencils.size_local</code></a></li><li><a href="#PencilArrays.Pencils.timer-Tuple{Pencil}"><code>PencilArrays.Pencils.timer</code></a></li><li><a href="#PencilArrays.Pencils.to_local-Tuple{Pencil}"><code>PencilArrays.Pencils.to_local</code></a></li><li><a href="#PencilArrays.Pencils.topology-Tuple{Pencil}"><code>PencilArrays.Pencils.topology</code></a></li><li><a href="#PencilArrays.Permutations.permutation-Tuple{Pencil}"><code>PencilArrays.Permutations.permutation</code></a></li></ul><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>More generally, an <span>$N$</span>-dimensional dataset is by default decomposed along its <span>$N - 1$</span> last dimensions.</li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a>Why would we want this? One application is to efficiently perform FFTs along <span>$y$</span>, which, under this permutation, would be the fastest dimension. This is used by the <a href="https://github.com/jipolanco/PencilFFTs.jl">PencilFFTs</a> package.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../PencilArrays/">Array wrappers »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Wednesday 25 September 2024 11:42">Wednesday 25 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
